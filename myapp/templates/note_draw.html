{% extends 'base.html' %}
{% load static %}
{% block contents %} 

<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>그림판 메모장</title>
    <style>

canvas {
        display: block; /* 가운데 정렬을 위해 추가 */
        border: 2px solid #51b5ef;
        width: 80%;
        height: 400px;
        border-radius: 8px;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        touch-action: none;
        margin: 0 auto; /* 중앙 정렬 */
    }

        /* 버튼 컨테이너 스타일 */
        .button-container {
            margin-top: 50px;
            margin-bottom: 100px;
            display: flex;
            justify-content: center;
            gap: 20px;
        }

        
        /* 버튼 스타일 */
.button-container button {
    background-color: #51b5ef;
    color: white;
    padding: 10px 20px;
    border: none;
    border-radius: 5px;
    font-size: 1rem;
    font-family: Pretendard-Bold;
    cursor: pointer;
    transition: background-color 0.3s ease;
    min-width: 100px; /* 버튼 크기 동일하게 */
    text-align: center;
}

        /* 버튼 호버 효과 */
        .button-container button:hover {
            background-color: #436bf1;
        }

        /* 제목 스타일 */
        h1 {
            text-align: center;
            font-family: Pretendard-ExtraBold;
            font-size: 3rem;
            color: #1d1e31;
            margin-top: 100px;
            margin-bottom: 30px;
        }

    </style>
</head>
<body>
    <h1>그림판 메모장</h1>
    <canvas id="drawingCanvas"></canvas>
    <div class="button-container">
        <button onclick="saveDrawing()">저장</button>
        <button onclick="clearCanvas()">지우기</button>
    </div>

    <script>
        const canvas = document.getElementById('drawingCanvas');
        const context = canvas.getContext('2d');
        let drawing = false;

        // 캔버스 크기 설정
        canvas.width = window.innerWidth * 0.9;
        canvas.height = 400;

        // 이벤트 핸들러 추가
        canvas.addEventListener('mousedown', startDrawing);
        canvas.addEventListener('mousemove', draw);
        canvas.addEventListener('mouseup', stopDrawing);
        canvas.addEventListener('mouseout', stopDrawing);

        canvas.addEventListener('touchstart', (e) => startDrawing(e.touches[0]));
        canvas.addEventListener('touchmove', (e) => draw(e.touches[0]));
        canvas.addEventListener('touchend', stopDrawing);

        function startDrawing(event) {
            drawing = true;
            context.beginPath();
            context.moveTo(event.clientX - canvas.offsetLeft, event.clientY - canvas.offsetTop);
            event.preventDefault();
        }

        function draw(event) {
            if (!drawing) return;
            context.lineTo(event.clientX - canvas.offsetLeft, event.clientY - canvas.offsetTop);
            context.stroke();
            event.preventDefault();
        }

        function stopDrawing() {
            drawing = false;
        }

        function clearCanvas() {
            context.clearRect(0, 0, canvas.width, canvas.height);
        }

        function saveDrawing() {
            const dataURL = canvas.toDataURL('image/png');
            fetch('/save_drawing/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': '{{ csrf_token }}'
                },
                body: JSON.stringify({ image: dataURL })
            }).then(response => {
                if (response.ok) {
                    alert("그림이 저장되었습니다!");
                    window.location.href = "{% url 'community' %}"; // community 페이지로 이
                } else {
                    alert("저장에 실패했습니다.");
                }
            });
        }
    </script>
</body>
</html>

{% endblock %}
